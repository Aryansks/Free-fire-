<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FF SENSI TOOL</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5;color:#111;}
header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#fff;border-bottom:3px solid red;position:sticky;top:0;z-index:100;}
button{padding:10px 20px;margin:5px;font-size:16px;background:red;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:0.2s;}
button:hover{background:#ff4d4d;transform:scale(1.05);}
.hidden{display:none;}
.container{padding:20px;}
h1,h2,h3{color:red;}
.scrollable{max-height:200px;overflow-y:auto;padding-right:5px;background:#fff;color:#111;border-radius:8px;padding:10px;margin-bottom:10px;}
input,select,textarea{padding:10px;margin:5px 0;width:100%;border-radius:8px;border:1px solid #ccc;background:#fff;color:#111;}
.card{border:1px solid red;padding:10px;margin:5px;border-radius:8px;background:#fff;transition:0.2s;}
.card:hover{background:#ffe6e6;}
#cartBtn{position:fixed;top:15px;right:15px;}
.announcement{animation:fadeIn 1s;}
.req-pending{color:orange;}
.req-accepted{color:green;}
.req-declined{color:red;}
@keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<header>
<div id="headerUser">Not logged</div>
<button id="logoutBtn" class="hidden" onclick="logout()">LOGOUT</button>
<button id="cartBtn" class="hidden" onclick="openCart()">ðŸ›’</button>
</header>

<div class="container" id="welcomeDiv">
<h1>ðŸ”¥ FF SENSI TOOL</h1>
<button onclick="showLogin()">LOGIN</button>
</div>

<div class="container hidden" id="loginDiv">
<h1>Login</h1>
<input type="text" id="loginUser" placeholder="Enter username">
<button id="loginBtn" onclick="login()">Login</button>
</div>

<div class="container hidden" id="homeDiv">
<h1>Welcome <span id="uname"></span></h1>
<div id="announcements" class="scrollable">No announcements yet</div>
<button id="sensiBtn" onclick="showSensi()">SENSI</button>
<button id="requestsBtn" onclick="showRequests()">REQUESTS</button>
</div>

<div class="container hidden" id="sensiDiv">
<h2>Select Company & Model</h2>
<select id="companySelect" onchange="renderModels()"></select>
<div id="modelList"></div>
<button onclick="backHome()">Back</button>
</div>

<div class="container hidden" id="requestsDiv">
<h2>My Requests</h2>
<div id="reqList" class="scrollable">No requests yet</div>
<button onclick="backHome()">Back</button>
</div>

<div class="container hidden" id="cartDiv">
<h2>ðŸ›’ My Cart</h2>
<div id="cartItems" class="scrollable">No items in cart</div>
<button onclick="continueCart()">Continue</button>
<button onclick="backHome()">Back</button>
</div>

<div class="container hidden" id="buyFormDiv">
<h2>Fill Form</h2>
<input type="text" id="buyName" placeholder="First Name"><br>
<input type="text" id="buyLast" placeholder="Last Name"><br>
<input type="text" id="buyUID" placeholder="In-Game UID"><br>
<button onclick="sendBuyRequest()">Send Request</button>
<button onclick="backHome()">Cancel</button>
</div>

<div class="container hidden" id="devDiv">
<h2>Developer Panel</h2>
<h3>User Requests</h3>
<div id="devReqList" class="scrollable">No requests yet</div>
<h3>Manage Announcements</h3>
<textarea id="announcementText" placeholder="Type announcement..." style="width:100%;height:60px;"></textarea><br>
<button onclick="sendAnnouncement()">Send Announcement</button>
<div id="devAnnList" class="scrollable"></div>
</div>

<script>
// --- Firebase configuration ---
const firebaseConfig = {
apiKey:"AIzaSyDYwUTHildowbImBqOHgIPM0pp0EVdd2UQ",
authDomain:"free-fire-sensi-c7674.firebaseapp.com",
databaseURL:"https://free-fire-sensi-c7674-default-rtdb.firebaseio.com",
projectId:"free-fire-sensi-c7674",
storageBucket:"free-fire-sensi-c7674.firebasestorage.app",
messagingSenderId:"282496876553",
appId:"1:282496876553:web:37e784f17ddcf5ae0bf8d8"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// --- Variables ---
let currentUser=null, selectedCompany='', selectedModel='', cart=[];

// --- Phone Companies & Models ---
const COMPANIES={
"Xiaomi":["Redmi Note 13 Pro","Redmi Note 13 Pro+","Mi 12","Mi 11","Poco X6 Pro","Redmi 12C","Redmi 11 Prime","Redmi K60 Ultra"],
"iPhone":["iPhone 16e","iPhone 15 Pro","iPhone 15","iPhone 14 Pro","iPhone 14","iPhone 13","iPhone 12 Mini","iPhone SE 3"],
"Samsung":["Galaxy S24 Ultra","Galaxy S23 Ultra","Galaxy S23+","Galaxy S23","Galaxy A54","Galaxy A14","Galaxy Z Fold5","Galaxy Z Flip5"],
"Nothing":["Nothing Phone 1","Nothing Phone 1T","Nothing Phone 2","Nothing Phone 2T","Nothing Phone 3 Pro","Nothing Phone 3a","Nothing Phone 4","Nothing Phone 4a"],
"Oppo":["Oppo Reno 10 Pro","Oppo F23","Oppo A77","Oppo Find X6"],
"Realme":["Realme GT3","Realme 12 Pro","Realme 11i","Realme Narzo 60x"],
"Vivo":["Vivo X100 Pro","Vivo V29","Vivo Y36","Vivo Y22"],
"OnePlus":["OnePlus 12","OnePlus 11R","OnePlus Nord 3","OnePlus 10T"],
"Huawei":["Huawei P60 Pro","Huawei Mate 60","Huawei Nova 12","Huawei Y9a"],
"Motorola":["Moto Edge 40","Moto G73","Moto G72","Moto X40"],
"LG":["LG Velvet 2","LG Wing 5G","LG V70","LG K62"],
"Nokia":["Nokia X30","Nokia G60","Nokia 5710","Nokia XR20"],
"Sony":["Sony Xperia 1 V","Sony Xperia 5 IV","Sony Xperia 10 IV","Sony Xperia L4"],
"Asus":["Asus ROG Phone 7","Asus Zenfone 10","Asus ROG Phone 6","Asus ROG Phone 5"]
};

// --- Device Best Sensitivity ---
const DEVICE_SENSI={};
for(const c in COMPANIES){COMPANIES[c].forEach(m=>{
DEVICE_SENSI[m]={GENERAL:Math.floor(Math.random()*150)+50,"RED DOT":Math.floor(Math.random()*150)+50,"2X":Math.floor(Math.random()*150)+50,"4X":Math.floor(Math.random()*150)+50,"SNIPER SCOPE":Math.floor(Math.random()*150)+50,"FREE CAMERA":Math.floor(Math.random()*150)+50};});}

// --- One-time login ---
window.onload=function(){
    const savedUser=localStorage.getItem('ffSensiUser');
    if(savedUser){currentUser=savedUser; showUserPanel();}
    else{document.getElementById('welcomeDiv').classList.remove('hidden');}
    populateCompanies(); fetchUserRequests(); fetchDevRequests(); fetchAnnouncements();
};

// --- Functions ---
function populateCompanies() {
    const select = document.getElementById('companySelect');
    select.innerHTML = '<option value="">Select Company</option>';
    for (let c in COMPANIES) {
        let opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        select.appendChild(opt);
    }
}

function renderModels() {
    selectedCompany = document.getElementById('companySelect').value;
    const modelDiv = document.getElementById('modelList');
    modelDiv.innerHTML = '';
    if (!selectedCompany) return;
    COMPANIES[selectedCompany].forEach(m => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `${m} <button onclick="openBuyForm('${m}')">BUY NOW</button>`;
        modelDiv.appendChild(card);
    });
}

function openBuyForm(model) {
    selectedModel = model;
    document.getElementById('sensiDiv').classList.add('hidden');
    document.getElementById('buyFormDiv').classList.remove('hidden');
}

function sendBuyRequest() {
    const first = document.getElementById('buyName').value.trim();
    const last = document.getElementById('buyLast').value.trim();
    const uid = document.getElementById('buyUID').value.trim();
    if(!first || !last || !uid){alert('Fill all fields'); return;}
    const reqData = {
        device: selectedModel,
        username: currentUser,
        status: 'PENDING',
        GENERAL: DEVICE_SENSI[selectedModel].GENERAL,
        REDDOT: DEVICE_SENSI[selectedModel]["RED DOT"],
        X2: DEVICE_SENSI[selectedModel]["2X"],
        X4: DEVICE_SENSI[selectedModel]["4X"],
        SNIPER: DEVICE_SENSI[selectedModel]["SNIPER SCOPE"],
        FREECAM: DEVICE_SENSI[selectedModel]["FREE CAMERA"]
    };
    db.ref('requests').push(reqData, function(error){
        if(error){alert('Error sending request');} 
        else{alert('Request sent!'); backHome();}
    });
    document.getElementById('buyName').value='';
    document.getElementById('buyLast').value='';
    document.getElementById('buyUID').value='';
}

function backHome() {
    document.getElementById('sensiDiv').classList.add('hidden');
    document.getElementById('buyFormDiv').classList.add('hidden');
    document.getElementById('requestsDiv').classList.add('hidden');
    document.getElementById('cartDiv').classList.add('hidden');
    document.getElementById('homeDiv').classList.remove('hidden');
}

function showSensi() {
    document.getElementById('homeDiv').classList.add('hidden');
    document.getElementById('sensiDiv').classList.remove('hidden');
}

function showRequests() {
    document.getElementById('homeDiv').classList.add('hidden');
    document.getElementById('requestsDiv').classList.remove('hidden');
    fetchUserRequests();
}

function fetchUserRequests() {
    const list = document.getElementById('reqList');
    list.innerHTML = '';
    db.ref('requests').orderByChild('username').equalTo(currentUser).on('value', snapshot => {
        list.innerHTML = '';
        snapshot.forEach(s => {
            const data = s.val();
            const d = document.createElement('div');
            d.className = 'card';
            let statusColor = (data.status==='PENDING')?'req-pending':(data.status==='ACCEPTED')?'req-accepted':'req-declined';
            d.innerHTML = `Device: ${data.device}<br>Username: ${data.username}<br>Status: <span class="${statusColor}">${data.status}</span>`;
            if(data.status==='ACCEPTED') {
                d.innerHTML += `<br><b>SENSI</b>: GENERAL-${data.GENERAL}, RED DOT-${data.REDDOT}, 2X-${data.X2}, 4X-${data.X4}, SNIPER-${data.SNIPER}, FREE CAM-${data.FREECAM}`;
            }
            list.appendChild(d);
        });
    });
}

// Developer Panel
function fetchDevRequests() {
    if(currentUser.toLowerCase()!=='dev999') return;
    const list = document.getElementById('devReqList'); list.innerHTML='';
    db.ref('requests').on('value', snapshot => {
        list.innerHTML='';
        snapshot.forEach(s=>{
            const data=s.val(); const key=s.key;
            if(data.status==='PENDING'){
                const d = document.createElement('div'); d.className='card';
                d.innerHTML=`Device: ${data.device}<br>Username: ${data.username}<br>Status: ${data.status}<br>
                <button onclick="devAccept('${key}')">Accept</button> 
                <button onclick="devDecline('${key}')">Decline</button>`;
                list.appendChild(d);
            }
        });
    });
}
function devAccept(key) { db.ref('requests/'+key).update({status:'ACCEPTED'}); }
function devDecline(key) { db.ref('requests/'+key).update({status:'DECLINED'}); }

// Announcements
function sendAnnouncement() {
    const txt = document.getElementById('announcementText').value.trim();
    if(!txt){alert('Enter announcement'); return;}
    const id = db.ref('announcements').push().key;
    db.ref('announcements/'+id).set({text:txt});
    document.getElementById('announcementText').value='';
    fetchAnnouncements();
}
function fetchAnnouncements() {
    const div = document.getElementById('announcements');
    div.innerHTML='';
    db.ref('announcements').on('value', snapshot=>{
        div.innerHTML='';
        snapshot.forEach(s=>{
            const d = document.createElement('div');
            d.className = 'announcement card';
            d.innerText = s.val().text;
            div.appendChild(d);
        });
        renderDevAnnouncements();
    });
}
function renderDevAnnouncements() {
    if(currentUser.toLowerCase()!=='dev999') return;
    const div = document.getElementById('devAnnList'); div.innerHTML='';
    db.ref('announcements').on('value', snapshot=>{
        div.innerHTML='';
        snapshot.forEach(s=>{
            const key=s.key; const val=s.val(); const d=document.createElement('div'); d.className='card';
            d.innerHTML=`${val.text} <button onclick="deleteAnnouncement('${key}')">Delete</button>`; 
            div.appendChild(d);
        });
    });
}
function deleteAnnouncement(key) { db.ref('announcements/'+key).remove(); }

// Login / Logout
function showLogin() {
    document.getElementById('welcomeDiv').classList.add('hidden'); 
    document.getElementById('loginDiv').classList.remove('hidden');
}

function login() {
    const username = document.getElementById('loginUser').value.trim();
    if(!username){alert('Enter username'); return;}
    currentUser = username;
    localStorage.setItem('ffSensiUser', currentUser);
    showUserPanel();
}

function showUserPanel(){
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('welcomeDiv').classList.add('hidden');
    if(currentUser.toLowerCase()==='dev999'){
        document.getElementById('devDiv').classList.remove('hidden');
        document.getElementById('headerUser').innerText='Developer';
    }else{
        document.getElementById('homeDiv').classList.remove('hidden');
        document.getElementById('headerUser').innerText=currentUser;
        document.getElementById('cartBtn').classList.remove('hidden');
    }
    document.getElementById('logoutBtn').classList.remove('hidden');
}

function logout(){
    localStorage.removeItem('ffSensiUser');
    location.reload();
}
</script>
</body>
</html>
